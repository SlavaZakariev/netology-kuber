## 22.12 Установка Kubernetes - Вячеслав Закариев

### Цель задания

Установить кластер K8s.

### Чеклист готовности к домашнему заданию

1. Развёрнутые ВМ с ОС Ubuntu 20.04-lts.

### Инструменты и дополнительные материалы, которые пригодятся для выполнения задания

1. [Инструкция по установке kubeadm](https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/).
2. [Документация kubespray](https://kubespray.io/).

---

### Задание 1. Установить кластер k8s с 1 master node

1. Подготовка работы кластера из 5 нод: 1 мастер и 4 рабочие ноды.
2. В качестве CRI — containerd.
3. Запуск etcd производить на мастере.
4. Способ установки выбрать самостоятельно.

---

### Дополнительные задания (со звёздочкой)

**Настоятельно рекомендуем выполнять все задания под звёздочкой.** Их выполнение поможет глубже разобраться в материале.   
Задания под звёздочкой необязательные к выполнению и не повлияют на получение зачёта по этому домашнему заданию. 

### Задание 2*. Установить HA кластер

1. Установить кластер в режиме HA.
2. Использовать нечётное количество Master-node.
3. Для cluster ip использовать keepalived или другой способ.

---

### Правила приёма работы

1. Домашняя работа оформляется в Git-репозитории в файле README.md. На выполненное задание пришлите ссылку на .md-файл.
2. Файл README.md должен содержать скриншоты вывода необходимых команд `kubectl get nodes`, а также скриншоты результатов.
3. Репозиторий должен содержать тексты манифестов или ссылки на них в файле README.md.

---

### Решение 1

1. Разворачиваем 6 ВМ:
   - Сервер IaaC - 192.168.0.50
   - Мастер-01 - 192.168.0.51
   - Воркер-01 - 192.168.0.52
   - Воркер-02 - 192.168.0.52
   - Воркер-03 - 192.168.0.53
   - Воркер-04 - 192.168.0.54

![hv](https://github.com/SlavaZakariev/netology-kuber/blob/f8173efd018be67b4410d0741375042d76f4c9e3/3.2/resources/kub_3-2_1.1.jpg)

2. На сервер IaaC устанавливаем Ansible и раскидываем на все узлы SSH, проверями связь с узлами

![ping](https://github.com/SlavaZakariev/netology-kuber/blob/f8173efd018be67b4410d0741375042d76f4c9e3/3.2/resources/kub_3-2_1.2.jpg)

3. Подготавливаем с помощью Ansible узлы Мастер и Воркеры:

```yaml
---
- name: pre-preparation of nodes before installation Kubernetes
  hosts: "all_k8s"
  become: yes
  roles:
  - 01_ufw            # Роль для FireWall
  - 02_Swapoff        # Роль для отключения файла подкачки
  - 03_Timezone       # Установка часового пояса МСК
  - 04_Dependent_soft # Установка зависимостей
```

- Настраиваем **FireWall** - [roles/01_ufw]()
- Отключаем файл подкачки **Swapoff** - [roles/02_Swapoff]()
- Настраиваем часовой пояс на узлах - [roles/03_Timezone]()
- Устанавливаем необходимые зависимости - [roles/04_Dependent_soft]()

